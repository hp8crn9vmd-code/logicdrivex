---
import SiteLayout from "../layouts/SiteLayout.astro";
import { offers } from "../data/offers";

const params = new URL(Astro.request.url).searchParams;
const selectedId = params.get("offer") ?? "";

const validOffer = offers.find(o => o.id === selectedId);
const defaultOffer = validOffer ? validOffer.id : "";

const pageTitle = "Request a Quote â€” LogicDriveX";
const base = import.meta.env.BASE_URL;

/**
 * IMPORTANT:
 * The Web3Forms key must come from an environment variable at build/run time.
 * Do NOT hardcode secrets in the repository.
 */
const accessKey = import.meta.env.PUBLIC_WEB3FORMS_ACCESS_KEY;

// For GitHub Pages (project base path), redirect must be absolute.
const redirectUrl = `${import.meta.env.SITE ?? ""}${base}thanks/`;
---
<SiteLayout title={pageTitle} lang="en">
  <main class="min-h-screen p-6">
    <div class="max-w-3xl mx-auto">
      <h1 class="text-3xl font-bold">Request a Quote</h1>
      <p class="mt-2 text-slate-600">
        Select the offer, describe required customizations, and submit your pricing request.
      </p>

      <form
        class="mt-8 space-y-6"
        method="POST"
        action="https://api.web3forms.com/submit"
      >
        <!-- Web3Forms -->
        <input type="hidden" name="access_key" value={accessKey} />
        <input type="hidden" name="redirect" value={redirectUrl} />

        <div>
          <label class="block font-semibold">Selected offer <span class="text-red-600">*</span></label>
          <select name="selected_offer" required class="mt-2 w-full rounded border p-2">
            <option value="">-- Select an offer --</option>
            {offers.map(o => (
              <option value={o.id} selected={o.id === defaultOffer}>
                {o.name}
              </option>
            ))}
          </select>
        </div>

        <div>
          <label class="block font-semibold">
            Required customizations <span class="text-red-600">*</span>
          </label>
          <textarea
            name="requested_customizations"
            required
            rows="6"
            placeholder="Describe exactly what you want changed/added. Include references, sections, and any constraints."
            class="mt-2 w-full rounded border p-2"
          ></textarea>
        </div>

        <div class="grid md:grid-cols-2 gap-4">
          <div>
            <label class="block font-semibold">
              Requested price (USD) <span class="text-red-600">*</span>
            </label>
            <input
              type="number"
              name="requested_price"
              required
              min="1"
              placeholder="e.g. 500"
              class="mt-2 w-full rounded border p-2"
            />
          </div>

          <div>
            <label class="block font-semibold">Your proposed price (optional)</label>
            <input
              type="number"
              name="client_proposed_price"
              min="1"
              placeholder="e.g. 450"
              class="mt-2 w-full rounded border p-2"
            />
          </div>
        </div>

        <div class="grid md:grid-cols-2 gap-4">
          <div>
            <label class="block font-semibold">Company / Project (optional)</label>
            <input
              type="text"
              name="company_or_project"
              placeholder="Company or project name"
              class="mt-2 w-full rounded border p-2"
            />
          </div>

          <div>
            <label class="block font-semibold">Phone / WhatsApp (optional)</label>
            <input
              type="text"
              name="phone_or_whatsapp"
              placeholder="+962..."
              class="mt-2 w-full rounded border p-2"
            />
          </div>
        </div>

        <div class="grid md:grid-cols-2 gap-4">
          <div>
            <label class="block font-semibold">Preferred language (optional)</label>
            <select name="preferred_language" class="mt-2 w-full rounded border p-2">
              <option value="">-- Choose --</option>
              <option value="EN">English</option>
              <option value="AR">Arabic</option>
            </select>
          </div>

          <div>
            <label class="block font-semibold">Desired deadline (optional)</label>
            <input
              type="date"
              name="desired_deadline"
              class="mt-2 w-full rounded border p-2"
            />
          </div>
        </div>

        <div>
          <label class="block font-semibold">Additional notes (optional)</label>
          <textarea
            name="additional_notes"
            rows="4"
            placeholder="Any links, examples, constraints, or special requirements."
            class="mt-2 w-full rounded border p-2"
          ></textarea>
        </div>

        <div class="grid md:grid-cols-2 gap-4">
          <div>
            <label class="block font-semibold">Name <span class="text-red-600">*</span></label>
            <input type="text" name="name" required class="mt-2 w-full rounded border p-2" />
          </div>
          <div>
            <label class="block font-semibold">Email <span class="text-red-600">*</span></label>
            <input type="email" name="email" required class="mt-2 w-full rounded border p-2" />
          </div>
        </div>

        <input type="checkbox" name="botcheck" class="hidden" style="display:none" />

        <button type="submit"
                class="rounded-xl bg-slate-900 text-white px-6 py-4 font-semibold">
          Submit request
        </button>
      </form>

      <p class="mt-6 text-sm text-slate-500">
        We only collect the information needed to evaluate scope and pricing. No marketing claims, no tracking promises.
      </p>
    </div>
  </main>
</SiteLayout>
